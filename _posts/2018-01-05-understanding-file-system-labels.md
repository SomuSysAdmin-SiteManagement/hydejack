---
layout : post
title : 'Understanding File System Labels'
tags : [RHCSA, RHCSA_mod, Managing SELinux, Understanding File System Labels]
categories: [RHCSA]
---


If we want to change the context using `semanage fcontext`, we should
know which context to use. There are many contexts to choose from. One
possible solution is to go to the target directory and view which
context the files use. For example, the contents of `/var/www` directory
use:

``` console
# ls -Z
drwxr-xr-x. root root system_u:object_r:httpd_sys_script_exec_t:s0 cgi-bin
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 html
```

The available contexts are: *httpd\_sys\_script\_exec\_t* and
*httpd\_sys\_content\_t*. A list of all possible contexts can be
displayed using `semanage fcontext -l`. However, it’s a long list and
grepping does help, but the filtered contents are still long:

``` console
# semanage fcontext -l | grep http
/usr/.*\.cgi                                       regular file       system_u:object_r:httpd_sys_script_exec_t:s0
/opt/.*\.cgi                                       regular file       system_u:object_r:httpd_sys_script_exec_t:s0
/srv/([^/]*/)?www(/.*)?                            all files          system_u:object_r:httpd_sys_content_t:s0
/srv/([^/]*/)?www/logs(/.*)?                       all files          system_u:object_r:httpd_log_t:s0
/var/www(/.*)?                                     all files          system_u:object_r:httpd_sys_content_t:s0
/var/www(/.*)?/logs(/.*)?                          all files          system_u:object_r:httpd_log_t:s0
...
/usr/share/wordpress-mu/wp-config\.php             regular file       system_u:object_r:httpd_sys_script_exec_t:s0
/usr/share/munin/plugins/http_loadtime             regular file       system_u:object_r:services_munin_plugin_exec_t:s0
/usr/share/system-config-httpd/system-config-httpd regular file       system_u:object_r:bin_t:s0
```

What do help are the SELinux man pages. On previous versions of RHEL,
the man pages were available through the command `man -k _selinux`.
However, on RHEL 7 these need to be generated by us using the `sepolicy`
utility, which isn’t installed by default. We can find which package
provides it using:

``` console
# yum provides */sepolicy
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
* base: centos.mirror.net.in
* extras: centos.mirror.net.in
* updates: centos.mirror.net.in
policycoreutils-devel-2.5-17.1.el7.i686 : SELinux policy core policy devel utilities
Repo        : base
Matched from:
Filename    : /usr/share/bash-completion/completions/sepolicy
Filename    : /usr/bin/sepolicy

policycoreutils-devel-2.5-17.1.el7.x86_64 : SELinux policy core policy devel utilities
Repo        : base
Matched from:
Filename    : /usr/share/bash-completion/completions/sepolicy
Filename    : /usr/bin/sepolicy

policycoreutils-python-2.5-17.1.el7.x86_64 : SELinux policy core python utilities
Repo        : base
Matched from:
Filename    : /usr/lib64/python2.7/site-packages/sepolicy
```

So, we need the policycoreutils development version. So, we install it
using the command `yum install -y policycoreutils-devel`.

Once installed, we need to run a command that helps us find the correct
man page for a SELinux command, which is:

``` console
# sepolicy manpage -a -p /usr/share/man/man8
/usr/share/man/man8/NetworkManager_selinux.8
/usr/share/man/man8/abrt_selinux.8
/usr/share/man/man8/abrt_dump_oops_selinux.8
...
/usr/share/man/man8/zoneminder_script_selinux.8
/usr/share/man/man8/zos_remote_selinux.8
# mandb
```

The command generates a list of manpages. Every service available on
SELinux has its own manpage, created by running this command. Once the
manpages have been generated, we should run the `mandb`, which updates
the index of the manpages, making them searchable using `man -k`.

So, to search for the SELinux manpages for anything concerning httpd, we
use:

``` console
# man -k _selinux | grep http
apache_selinux (8)   - Security Enhanced Linux Policy for the httpd processes
httpd_helper_selinux (8) - Security Enhanced Linux Policy for the httpd_helper processes
httpd_passwd_selinux (8) - Security Enhanced Linux Policy for the httpd_passwd processes
httpd_php_selinux (8) - Security Enhanced Linux Policy for the httpd_php processes
httpd_rotatelogs_selinux (8) - Security Enhanced Linux Policy for the httpd_rotatelogs processes
httpd_selinux (8)    - Security Enhanced Linux Policy for the httpd processes
httpd_suexec_selinux (8) - Security Enhanced Linux Policy for the httpd_suexec processes
httpd_sys_script_selinux (8) - Security Enhanced Linux Policy for the httpd_sys_script processes
httpd_unconfined_script_selinux (8) - Security Enhanced Linux Policy for the httpd_unconfined_script processes
httpd_user_script_selinux (8) - Security Enhanced Linux Policy for the httpd_user_script processes
```

Inside these manpages, all booleans and contexts are defined. So, we
have a place to look up the appropriate context for the kind of access
that our files/processes need.
